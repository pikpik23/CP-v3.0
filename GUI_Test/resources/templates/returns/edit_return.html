{% extends '/includes/layout.html' %} {% block body %}
<script src="js_files/jquery-3.1.1.js"></script>
<script type="text/javascript">
	var saved = true;
</script>
<script type="text/javascript">  
    $(document).ready(function ($) {
		
        $("#back").click(function (){
            window.location.href = '/settings';
        });
        $("#instructions").click(function (){
            $.ajax({
            url: "/edit_return/info",
            type: "get",
            success: function(response) {
                $("#serial-list").html(response);
            },
            error: function(xhr) {
            //Do Something to handle error
            }
            });
        });
        $("#instructions").click();
        
        {% for return_type in serials_def %}
        $("#{{return_type}}").click(function () {
            //$("#serials").attr("src", "edit_return/{{return_type}}");
			if (saved == true) {
				$.ajax({
					url: "/edit_return/{{return_type}}",
					type: "get",
					success: function(response) {
					$("#serial-list").html(response);
					},
					error: function(xhr) {
					//Do Something to handle error
					}
            	});
			}
			else if (saved == false) {
				alert('unsaved changes')
			}
			else {
				alert('it didnt work')
			}

        });
        {% endfor %}

        $(document).find('.btnSave').hide();
	    $(document).find('.btnCancel').hide(); 
        
        $(document).on('click', '.btnEdit', function(event) 
	    {
			event.preventDefault();
			var tbl_row = $(this).closest('tr');
			var row_id = tbl_row.attr('row_id');

			tbl_row.find('.btnSave').show();
			tbl_row.find('.btnCancel').show();

			//hide edit button
			tbl_row.find('.btnEdit').hide(); 

			//make the whole row editable
			tbl_row.find('.row_data')
			.attr('contenteditable', 'true')
			.attr('edit_type', 'button')
			.addClass('edit')

			//--->add the original entry > start
			tbl_row.find('.row_data').each(function(index, val) 
			{  
				//this will help in case user decided to click on cancel button
				$(this).attr('original_entry', $(this).html());
			}); 		

	});
	//--->button > edit > end

	$(document).on('click', '.btnRemove', function(event) 
	{
		var check = confirm('Are you sure you would like to remove this Return? This can not be undone.')
		if (check == true) {
			$(this).closest('tr').remove()
		}
		
	});

	$("#add_return").click(function (){
		$(".table_serials_outer tr:last").after('<tr> <td><div class="row_data" col_name="return"></div></td><td><span class="btnEdit"> <a href="#" class="btn_action" row_id="" > Rename</a> </span><span class="btnSave"> <a href="#" class="btn_action" row_id="" > Save</a> </span><span class="btnCancel"> <a href="#" class="btn_action" row_id="" > Cancel</a> </span> <span class="btnSerials"> <a href="#" class="btn_action" > Edit Serials</a> </span><span class="btnRemove"> <a href="#" class="btn_action" row_id="" >Remove</a> </span></td></tr>');
		$(".table_serials_outer tr:last").find($(".btnEdit")).click();

	});


	//--->button > cancel > start	
	$(document).on('click', '.btnCancel', function(event) 
	{
		event.preventDefault();

		var tbl_row = $(this).closest('tr');

		var row_id = tbl_row.attr('row_id');

		//hide save and cacel buttons
		tbl_row.find('.btnSave').hide();
		tbl_row.find('.btnCancel').hide();

		//show edit button
		tbl_row.find('.btnEdit').show();

		//make the whole row editable
		tbl_row.find('.row_data')
		.attr('edit_type', 'click')
		.removeClass('edit');

		tbl_row.find('.row_data').each(function(index, val) 
		{   
			$(this).html( $(this).attr('original_entry') ); 
		});  
	});
	//--->button > cancel > end

	
	//--->save whole row entery > start	
	$(document).on('click', '.btnSave', function(event) 
	{
		event.preventDefault();
		var tbl_row = $(this).closest('tr');

		var row_id = tbl_row.attr('row_id');
		
		//hide save and cacel buttons
		tbl_row.find('.btnSave').hide();
		tbl_row.find('.btnCancel').hide();

		//show edit button
		tbl_row.find('.btnEdit').show();
		
		tbl_row.find('.row_data')
		.attr('contenteditable', 'false')
		.css('padding','') 
        .removeClass('edit')	
	
		var row_id = tbl_row.find('.row_data').html();
		tbl_row.attr("row_id",row_id);

		tbl_row.find('.btnSerials')
		.attr('id',row_id)
		.attr('row_id',row_id)
		
		var ret_arr = []

		$('.return_body').find('tr').each(function(element,val) {
			var ret_type = $(this).attr('row_id');
			// alert(ret_type);
			ret_arr.push(ret_type);
			
		});
        alert(ret_arr)
		$.post("/edit_return/return_update", ret_arr, function(data, status){
			//alert("Data: " + data + "\nStatus: " + status);
			});
		

		});
	});


</script>
<div class="mainSetting">
    <div class="return-list">
        <div class="banner">
            <a>Returns</a>
        </div>
        <div class="section_left"> 
            <div>
                <button id="back" class="edit_buttons">Back to Settings</button>
                <button class="edit_buttons" id="instructions">Instructions</button>
            </div>
            <table id="table_serials" class="table_serials_outer" id="edit_return">
                <tr>
                    <th class="return_column">Return Name</th>
                    <th>Options</th>
                </tr>
				
				<tbody class="return_body">
				{% for return_type in serials_def %}
                <tr row_id="{{return_type}}">
                    <td><div class="row_data" col_name="return">{{ return_type }}</div></td>
                	<td>
                    <span class="btnEdit"> <a href="#" class="btn_action"  > Rename</a> </span>
                    <span class="btnSave"> <a href="#" class="btn_action"  > Save</a> </span>
                    <span class="btnCancel"> <a href="#" class="btn_action" > Cancel</a> </span>
                    <span id="{{return_type}}" class="btnSerials"> <a href="#" class="btn_action" > Edit Serials</a> </span>
                    <span class="btnRemove"> <a href="#" class="btn_action" > Remove</a> </span>
                    
                </td>
                </tr>
				{% endfor %}
				</tbody>
            </table>
            <button class="add" id="add_return">Add Return</button>
        </div>
    </div>
    <div id="serial-list">
        <!--<div class="banner">
            <a>Returns</a>
        </div>
        <iframe id="serials" src="edit_return/MAINTDEM"></iframe> -->

    </div>
</div>
{% endblock %}